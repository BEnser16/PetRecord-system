<!DOCTYPE html>
<head>
    <meta charset=UTF-8 />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <!-- bootstrap -->
    <!-- <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.1/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.1/dist/js/bootstrap.bundle.min.js"></script> -->
    <title>寵物醫院</title>
</head>
<body>
  <input id="petID" type="text" value="62f158acef8b6c7bfd89c9b7" />
  <button id="btn" type="button">搜尋</button>
  <div id="info-list">
    <h2>基本資料</h2>
    <div>寵物名:</div>
    <div>種類:</div>
    <div>品種:</div>
    <div>飼主:</div>
    <div>電話:</div>
    <div>病歷號:</div>
    <div>晶片號:</div>
    <div>生日:     年齡:</div>
    <div>性別:     血型:</div>
    <div>結紮:</div>
    <div>過敏:</div>
    <div>重大疾病:</div>
    <div>備註:</div>
  </div>
  <div id="case-list">
    <h2>病歷紀錄</h2>
    <div>紀錄時間:</div>
    <div>主治醫生:</div>
    <div>看診類別:</div>
    <div>詳細說明:</div>
  </div>
    <!-- axios -->
    <script
      src="https://cdnjs.cloudflare.com/ajax/libs/axios/0.21.1/axios.min.js"
      integrity="sha512-bZS47S7sPOxkjU/4Bt0zrhEtWx0y0CRkhEp8IckzK+ltifIIE9EMIMTuT/mEzoIMewUINruDBIR/jJnbguonqQ=="
      crossorigin="anonymous"
      referrerpolicy="no-referrer"
    ></script>
    <script>
        const btn = document.getElementById("btn");
        const searchID = document.getElementById("petID");
        const infoList = document.getElementById("info-list");
        const caseList = document.getElementById("case-list");

        const getInfo = async (petID) => {
          try {
            const response = await axios.get(`/api/v1/information/${petID}`);

            let nowTime = new Date()
            let birthdayTime = new Date(response.data.info.birthday)
            let age = Math.floor(((nowTime - birthdayTime) / (24 * 3600 * 1000))/365)     

            infoList.innerHTML = `<div id="info-list">
            <h2>基本資料</h2>
            <div>寵物名:${response.data.info.name}</div>
            <div>種類:${response.data.info.species}</div>
            <div>品種:${response.data.info.breed}</div>
            <div>飼主:${response.data.info.owner}</div>
            <div>電話:${response.data.info.phone}</div>
            <div>病歷號:${response.data.info._id}</div>
            <div>晶片號:${response.data.info.chip}</div>
            <div>生日:${response.data.info.birthday}     年齡:${age}歲</div>
            <div>性別:${response.data.info.gender}     血型:${response.data.info.bloodType}</div>
            <div>結紮:${response.data.info.ligation}</div>
            <div>過敏:${response.data.info.allergy}</div>
            <div>重大疾病:${response.data.info.majorDiseases}</div>
            <div>備註:${response.data.info.remark}</div>
          </div>`;
          } catch (error) {
            console.log(error);
          }
        };

        const getCase = async (petID) =>{
          try {
            const response = await axios.get(`/api/v1/case/${petID}`);

            if (response.data.illness.length === 0) {
              caseList.innerHTML = `<div id="case-list">
              <h2>病歷紀錄</h2>
              <div>紀錄時間:無</div>
              <div>主治醫生:無</div>
              <div>看診類別:無</div>
              <div>詳細說明:無</div>
            </div>`
              return
            }

            caseList.innerHTML = `<div id="case-list">
            <h2>病歷紀錄</h2>
            <div>紀錄時間:${response.data.illness[0].date}</div>
            <div>主治醫生:${response.data.illness[0].doctor}</div>
            <div>看診類別:${response.data.illness[0].type}</div>
            <div>詳細說明:${response.data.illness[0].describe}</div>
          </div>`
          } catch (error) {
            console.log(error);
          }
        }

        btn.addEventListener("click", () => {
          getInfo(searchID.value);
          getCase(searchID.value);
        });
    </script>
    
</body>
</html>